---
title: 技术美术百人计划学习笔记（图形5.1.2 基于物理的相机）
date: 2023-08-12 13:01:11
tags: 
 - Shader
 - TA
 - 百人计划
categories: Notes
keywords: '技术美术百人计划'
description: 介绍了真实世界中相机的运作原理、各个参数的影响、Bloom的物理原理，以及Unity的基于物理的相机
top_img: https://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/97358036_p0_master1200.jpg
cover: https://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/TA100.png
swiper_index: 1 
katex: true

---

![](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/TA100T5100.png)

## 曝光三角形

### 曝光主要由三个参数控制

![](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/image-20230910152658446.png)

- **快门速度（Shutter Speed）**：快门开启的有效时间长度的衡量方式，代表了这个相机拍摄一个图像记录多少光线信息。----可以获得**运动模糊（Motion Blur）**
- **光圈（Aperture）**：控制一个瞬间进光量的多少。----可以获得**景深（Depth of Field）**
- **感光度（ISO）**：衡量底片对光的敏感程度。----可以获得**噪点（Grain）**

以上三个参数协同工作，调节进入传感器（Sensor）的光量（由光圈和快门速度控制）和该表面的感光度（传统的胶片或现代的数字ISO）

![光先通过光圈(Aperture)控制后，再通过快门（Shutter），最后再到达传感器（ Sensor ）上](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/image-20230910152719116.png)

### 摄像机流水线

![摄像机流水线](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/TA100T5120-1.png)

- 由场景亮度（Scene Luminance）光传递到镜头的光圈（Lens），由光圈（Lens）传递到传感器亮度（Sensor illuminance）
- 由传感器亮度传递到快门 （Shutter），由快门 （Shutter）传递到传感器曝光（Sensor Exposure）
- 由传感器曝光（Sensor Exposure）传递到电耦合元件（CCD），由电耦合元件（CCD）传递到模拟电压（Analog Voltages），模拟电压（Analog Voltages）再传递到模拟数字转换器（ADC），模拟数字转换器（ADC）再输出数字值（Digital Values）
- 对数字值（Digital Values）进行重映射（Remapping）最后输出像素值（Pixel Values）



摄影师艺术家则可以控制**相对光圈，快门时间，传感器灵敏度/增益三个主要参数来设置曝光**

以人眼为例：

- 光圈(Aperture) 的功能就像眼睛的虹膜一样，可以张开并收缩其开口的直径来限制允许进入眼睛的光量
- 快门速度(Shutter Speed) 类似于眨眼，只是在我们清醒时眼睑通常是打开的。想象一下，你的眼皮在闭上之前瞬间张开以捕捉单个图像，那就像是相机的快门
- 感光度(ISO) 类似于眼睛后部视杆和视锥细胞的灵敏度



### 曝光补偿

曝光补偿是一种曝光控制方式，一般常见在±2\~3EV。以前胶片时代只能调1个EV，而现在数码能调动1\~3个EV。**EV值每增加1.0，相当于进光量增加一倍。EV值每减小1.0，相当于进光量减小一倍**。如果环境光源偏暗调节上述三个参数（快门速度、光圈、感光度）达不到效果或者手动挡调参失败，即可增加曝光值(如调整为+1EV、+2EV)以突显画面的清晰度

![](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/image-20230910153030474.png)

曝光补偿就是有意识地变更相机自动演算出的“合适”曝光参数，让照片更明亮或者更昏暗的拍摄手法。拍摄者可以根据自己的想法调节照片的明暗程度，创造出独特的视觉效果等。一般会使用变更光圈值或者快门速度来进行曝光值的调节。**曝光补偿则放在最后**

### 直方图

直方图是用以表示数字图像中亮度分布的直方图，标绘了图像中每个亮度值的像素数。可以借助观察该直方图了解需要如何调整亮度分布

![](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/image-20230910153110824.png)

这种直方图中，横坐标的左侧为纯黑、较暗的区域，而右侧为较亮、纯白的区域。因此，一张较暗图片的图像直方图中的数据多集中于左侧和中间部分；而整体明亮、只有少量阴影的图像则相反

![](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/image-20230910153154292.png)

直方图是用来观察照片是否曝光的重要利器，现代数码相机内应该都会内置直方图。直方图主要是为了帮助我们在拍摄的过程中有一个参考，以确保我们所拍摄的照片不会丢失高光或者阴影中的任何细节，帮助我们在拍摄照片的时候就能够分析这张照片有没有丢失细节，或者是否过曝

![](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/TA100T5120-2.png)



## 快门速度

### 快门

快门 (Shutter) 类似于眨眼，只是在我们清醒时眼睑通常是打开的。想象一下，你的眼皮在闭上之前瞬间张开以捕捉单个图像，那就像是相机的快门

> 大部分相机的快门需要半按才能对焦，对焦完成可以全按拍摄

![](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/image-20230910153323590.png)

几乎所有现代单反和数码单反相机都使用**焦平面快门**。焦平面快门的工作方式更像车库的门。但有第二扇门，称为帘幕。在第一个帘幕打开后，帘幕紧跟在第一个帘幕后面以关闭图像传感器或胶片。这种双帘设计可实现传感器或胶片上的光线平衡，从而使曝光均匀。这种设计允许在当今的单镜头反光（SLR） 和数码单反相机（DSLR） 相机上实现极快的操作，最高可达 1/8000 秒。

如今的快门已经数字化了。许多**现代数码相机操作电子快门**，我们只需在按下的瞬间为数字传感器供电。所以电子快门速度可以非常快。快门打开和关闭到整个传感器的过程一次完成，滚动电子快门在横跨其宽度的时间内激活一行像素

### 快门速度

定义：快门速度是衡量相机快门打开的时间——允许光线照射到感光传感器的时间

![](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/TA100T5120-3.png)

焦平面快门和滚动电子快门，由于它们的设计和功能，当图像平面上有快速运动时，都会导致图像产生有趣的失真

![](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/image-20230910153438492.png)

所以当我们拍摄高度运动的物体，如汽车，奔跑的人时，**快门速度应该调快，才可以弥补这种视觉残影的效果。但是这意味着感光器收到的光线不足**，也就是接下来要解决的问题



## 光圈

光圈是一个用来**控制光线透过镜头，进入机身内传感器光量**的装置，通常是在镜头内。已经制造好的镜头，我们不可能随意改变镜头的直径，但是我们可以通过在镜头内部加入多边形或者圆形，且面积可变的孔状光栅片来达到控制镜头通光量，这个装置就叫做光圈

光圈(Aperture) 的功能就像眼睛的虹膜一样，可以张开并收缩其开口的直径来**限制允许进入眼睛的光量**

![](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/image-20230910153542931.png)

### 光圈大小

表达光圈大小我们是用F数表示通常称为f-number(N)，记作F/。透镜的焦距(F)与孔径(D)的比，我们记为N= F/D ,孔径(D)越大，进入相机的光线就越多。光圈不等同于F数，恰恰相反，**光圈大小与F数大小成反比**，F数又称光圈数。如大光圈的镜头，F数小，光圈数小；小光圈的镜头，F数大

![不同F值光圈的图形表示](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/image-20230910153627625.png)

比如F/1.2、F/1.8、F/2.8这三组数值都表示大光圈（一般F/+一个数值特指光圈数值），其中F/1.2的光圈最大，而F/18、F/22、F/32则表示小光圈，其中F/32最小

【光圈的计算】

光圈可以理解为一个圆形，圆的面积公式是：面积 =  π 乘以半径的平方

> 光圈大小的相邻间隔都是以根号二为倍数的（也就是以面积为两倍的相邻间隔进行区分）

![光圈的计算方式](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/image-20230910153718679.png)

所以如果将相机光圈设置为 F/8，拍摄一张图，然后将光圈调整到 F/5.6，那么通过镜头的光量则增加了一倍（x2）。从 F/8 改为F/4 会使光量增加三倍（x4）。从 F/11 到 F/16 则减少了一半的光量（x1/2）。遵循**反平方定律**

【光圈与景深】

如果将光圈从 f/16 扩大到 f/11，进光面积增加为原来2倍， 照片将获得 +1 EV （曝光值）结果，f/16 到 f/8 使光圈开口尺寸加倍，进光面积增加为原来四倍，则表示 +2 EV 偏移。回到上面，曝光部分，如果我们光圈小了，则可以通过控制EV来增强。

![](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/image-20230910153757032.png)

同时，在光圈大的图像中，拍摄主体的边缘会有明显的模糊效果，这个效果被称为**景深**

> 景深定义：在图像中**看起来清晰对焦的最近和最远对象之间的一个距离量**。例如摄影过程中，主物体清晰对焦，但其余部分会模糊。**景深起到了感知深度的作用**。

【衍射现象】

光圈不仅控制通过镜头的光量，还影响光线穿过镜头时的角度。**光线经过孔径光栅时被轻微弯曲**，光的这种弯曲称为“**衍射**”，是光的波动特性

![](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/image-20230910153849851.png)

缩小镜头的孔径光栅时，会使衍射更接近图像的中心。很多摄影师在刚开始了解光圈的时候，因为光圈对景深的影响，认为最大化锐度的关键是小光圈。然而这是不正确的。**由于存在衍射，尽管通过缩小光圈来去除景深，但图像中的衍射量也在增加，这就会导致图像失去清晰度。**光圈的中间地带，即**景深且衍射可控的区域**，被称为镜头的“最佳位置” ，**一般是在 f/4 和 f/11 之间的区域，具体数值取决于镜头的设计**



## ISO感光度

感光度(ISO) 类似于眼睛后部视杆和视锥细胞的灵敏度，与快门速度一样是线性的。ISO 为 200 对光的敏感度是 ISO 等级为 400 的一半。ISO 加倍，感光度加倍。一半的 ISO，一半的感光度

![不同的ISO会使画面亮度不一样](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/image-20230910154023733.png)

因此，假设所有其他条件都不变，如果将相机的 ISO 从 400 更改为 200，则得到-1的EV （曝光）偏移，ISO 800 更改为 ISO 1600 ，感光度加倍，则+1 EV偏移



## 胶片颗粒Grain

提升数码相机的ISO是通过两种方式实现的：

1. 强行提高每个像素点的亮度和对比度；
2. 使用多个像素点共同完成原来只要一个像素点来完成的任务。

这也导致了一个效果——数字噪点（Grain）ISO 越高，图像中引入的数字噪点就越多。少量的胶片颗粒感可以改善照片的感觉和质感，但是这并不是可以为之的

![image-20230910154120666](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/image-20230910154120666.png)



## 相机与引擎

### 构建HDRP下基于物理的摄像机环境

![](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/TA100T5120-4.png)

![](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/TA100T5120-5.png)

HDRP渲染管线环境，我们在Camera组件下找到Camera Body和 Lens 以及Aperture，勾选上Physical Camera同时将Volume组件挂上Exposure和Depth of field并且设置Mode为Camera。即可启用基于物理的相机。

这里的基于物理是根据相机和摄影知识理论构建的，但是目前阶段不算是很完善，比如Grain并不会因为ISO过高而产生效果，需要自己额外再Volume组件设置。也不会因为光圈越小产生衍射

### 快门速度、光圈、感光度的调节

快门速度：其他属性都不变的情况下，快门速度越快，曝光就越低，呈**线性下降**

光圈：其他属性都不变的情况下，光圈数越大，曝光就越小，呈**指数下降** ，景深效果越弱

感光度：其他属性都不变的情况下，感光度越小，曝光值越小。因为没有Grain效果 ，所以高感光度所产生的Grain效果并没有增加上

### 焦距(Focus Distance)和焦长(Focal Lengh)

焦距主要用来对焦，单反相机一般会自动对焦，也可以手动对焦

焦长则模拟了不同类型的镜头，从拍摄花草鱼虫的微距镜头一直到打鸟射月的长焦镜头的模拟

![](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/TA100T5120-6.png)



## 自发光与Bloom

【Bloom的原因】

1. 高亮的值使得数码相机的传感器饱和，并且**泄漏到临近的传感器单元**
2. 光线在摄像机镜头内反射
3. 相机镜头内或者表面有灰尘

像素的最终亮度取决于相机的设置，EV值决定了是否产生Bloom的效果。当入射的亮度超过了传感器本身最大的亮度值，就会产生Bloom

![](http://qiuhanblog-imgsubmit.oss-cn-beijing.aliyuncs.com/img/image-20230910154411206.png)

【难题：特效设计师想要白天和夜晚效果一致的Bloom】

--对于自发光表面：可以给设计师提供工具控制Bloom：

1. 给自发光表面定义“曝光补偿”，用于调整它的强度，确保该强度超过饱和点。
2. 该项是场景全局值，额外的曝光被注入场景内，使得自发光表面变量或者变暗。

【HDRP对于自发光的强度控制】

`_EmissiveIntensity` 不是一个独立的属性。 着色器仅使用 `_EmissiveIntensity` 来序列化 UI 中的属性，并将最终结果存储在 `_EmissiveColor` 属性中



## Sunny-16法则

- 是摄影术中不借助电子测光表来**估计照相机的光圈大小和快门长短的方式**

- **阳光16法则示例：在室外阳光下，光圈为F/16 ，ISO为100，快门时间为1/125s**

- 在**室外阳光下**，如果光圈是 f/16，则快门速度应是所用胶片的国际感光度指数的倒数
  - 例如，在**室外阳光下**，如用光圈是 f/16，而ISO为100，则快门应为 1/100s（或者1/125）。

- “16”，并不是光圈非f/16不可，如选用f/11,则快门速度当提高一倍成为 1/200秒，以此类推。
  - 其次，**要根据天气状况作调整**，如并非阳光普照，而是多云，ISO为100，如果快门速度仍旧取 1/100s，则光圈应从1/16开大一倍到1/11；依此类推。

